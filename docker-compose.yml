services:
  google-docs-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: google-docs-mcp-server

    # Mount credentials for Google OAuth
    volumes:
      - ./credentials/credentials.json:/app/credentials.json:ro
      - ./credentials/token.json:/app/token.json

    stdin_open: true
    tty: true

    # Expose port for potential SSE transport
    ports:
      - "3000:3000"

    # Restart policy
    restart: unless-stopped

    environment:
      - NODE_ENV=production

  # Service for initial authentication (token.json is writable)
  # Use: docker-compose run --rm auth
  auth:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: google-docs-mcp-auth

    volumes:
      - ./credentials/credentials.json:/app/credentials.json:ro
      - ./credentials/token.json:/app/token.json

    stdin_open: true
    tty: true

    command: ["node", "./dist/server.js"]

    profiles:
      - auth
